{% extends "bootstrap/base.html" %}

{% block title %}シフト作成{% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet", href="{{ url_for('static', filename='css/createShift.css') }}">
{% endblock %}

{% block body %}
<div class="container" id="app">
    <h3>シフト作成{{ TARGET_DATE_STR }}</h3>
    <hr>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="{{ category }}">{{ message }}</div>
            {% endfor %}
            <hr>
        {% endif %}
    {% endwith %}
    <h4>作成手順</h4>
    <p>チェックボックスを上から順に埋めてください</p>
    <hr>
    <details>
        <summary><h4>条件の設定</h4></summary>
        <form method="POST" class="conditionArr">
            <section class="conditionInput">
                <label>
                    {{ CONDITION_LIST[0] }}
                    <select name="event" v-model="event" required="required">
                        <option value="0">{{ EVENT_LIST[0] }}</option>
                        <option value="1">{{ EVENT_LIST[1] }}</option>
                        <option value="2">{{ EVENT_LIST[2] }}</option>
                        <option value="3">{{ EVENT_LIST[3] }}</option>
                        <option value="4">{{ EVENT_LIST[4] }}</option>
                        <option value="5">{{ EVENT_LIST[5] }}</option>
                    </select>
                </label>
                <label>社員<input type="number" name="sumFullTime" v-model="sumFullTime" min="0" max="5" required="required">人</label>
                <label>バイト<input type="number" name="sumPartTime" v-model="sumPartTime" min="0" max="5" required="required">人</label>
                <br>
                <br>
                <section class="row conditionInputTable">
                    <section class="column">
                        <div class="th">{{ PARTID_START_END_LIST[0] }}</div>
                        <div class="th">{{ PARTID_START_END_LIST[1] }}</div>
                        <div class="th">{{ PARTID_START_END_LIST[2] }}</div>
                    </section>
                    <section class="column" v-for='loop in this.sumPartTime_realTime'>
                        <label class="td">[[ loop ]]</label>
                        <input
                            type="number" class="td"
                            :name="[[ 'partStart' + loop ]]"
                            min="{{ PART_TIME_START_OPTION_LIST[0] }}"
                            max="{{ PART_TIME_START_OPTION_LIST[-1] }}"
                        >
                        <input
                            type="number" class="td"
                            :name="[[ 'partEnd' + loop ]]"
                            min="{{ PART_TIME_END_OPTION_LIST[0] }}"
                            max="{{ PART_TIME_END_OPTION_LIST[-1] }}"
                        >
                    </section>
                </section>
            </section>
            <br>
            <p>既に設定されている「日付の種類」と「社員の数」のペアで新たに追加すると上書きされます</p>
            <input type="submit" class="btn btn-primary" value="追加する" formaction="/admin/create/shift/add/condition" formmethod="POST">
        </form>
        {% if conditionArr %}
            {% for iEvent in range(EVENT_LIST | length) %}
                <hr>
                <h5>{{ EVENT_LIST[iEvent] }}</h5>
                <section class="row">
                    {% for condition in conditionArr %}
                        {% if condition.event == iEvent %}
                            <section class="conditionTable row">
                                <a href="/admin/create/shift/delete/condition/{{ condition.id }}" role="button">✕</a>
                                <section class="column">
                                    <span class="tabelSpan headLabel">{{ CONDITION_LIST[1] }}</span>
                                    <span class="tabelSpan headLabel">{{ CONDITION_LIST[2] }}</span>
                                    <span class="tabelSpan headLabel">{{ CONDITION_LIST[3] }}</span>
                                </section>
                                <section class="column">
                                    <span class="tabelSpan">{{ condition.sum_full_time }}</span>
                                    <span class="tabelSpan">{{ condition.sum_part_time }}</span>
                                    <span class="tabelSpan">{{ condition.last }}</span>
                                </section>
                                <br>
                                <section class="conditionPartTimeTable column">
                                    <span class="tabelSpan headLabel">{{ PARTID_START_END_LIST[0] }}</span>
                                    <span class="tabelSpan headLabel">{{ PARTID_START_END_LIST[1] }}</span>
                                    <span class="tabelSpan headLabel">{{ PARTID_START_END_LIST[2] }}</span>
                                </section>
                                {% for conditionPartTime in conditionPartTimeArr %}
                                    {% if conditionPartTime.Condition.id == condition.id %}
                                        <section class="column">
                                            <span class="tabelSpan timeTd">{{ conditionPartTime.ConditionPartTime.part_id }}</span>
                                            <span class="tabelSpan timeTd">{{ conditionPartTime.ConditionPartTime.start }}</span>
                                            <span class="tabelSpan timeTd">{{ conditionPartTime.ConditionPartTime.end }}</span>
                                        </section>
                                    {% endif %}
                                {% endfor %}
                            </section>
                        {% endif %}
                    {% endfor %}
                </section>
            {% endfor %}
        {% else %}
            <br>
            <p>まだ条件が設定されていません</p>
        {% endif %}
    </details>
    <hr>
    <details>
        <summary><h4>祝日・祝前日の設定</h4></summary>
        <form method="POST" class="publicHolidayArr">
            <section class="publicHolidayInput">
                <label>
                    {{ CONDITION_LIST[0] }}
                    <select name="event" v-model="event" required="required">
                        <option value="4">{{ EVENT_LIST[4] }}</option>
                        <option value="5">{{ EVENT_LIST[5] }}</option>
                    </select>
                </label>
                <label>
                    <select name="day" required="required">
                        {% for iDay in range(SUM_DAYS_OF_TARGET_MONTH) %}
                            <option value="{{ iDay+1 }}">{{ iDay+1 }}</option>
                        {% endfor %}
                    </select> 日
                </label>
            </section>
            <br>
            <input type="submit" class="btn btn-primary" value="追加する" formaction="/admin/create/shift/add/publicHoliday" formmethod="POST">
        </form>
    </details>
    <hr>
    <h4>希望シフト</h4>
    {% if hopeShiftArr %}
        <section class="hopeShiftTable">
            <span class="tabelSpan headLabel">氏名</span>
            <span class="tabelSpan headLabel">区分</span>
            <span class="tabelSpan headLabel">レベル</span>
            {% for iDay in range(31) %}
                {% if iDay < SUM_DAYS_OF_TARGET_MONTH %}
                    <span for="empty" class="tabelSpan headLabel">{{ iDay+1 }}</span>
                {% else %}
                    <span for="empty" class="tabelSpan headLabel"></span>
                {% endif %}
            {% endfor %}
            <span for="empty" class="tabelSpan headLabel"></span>
            <span for="empty" class="tabelSpan headLabel"></span>
            {% for hopeShift in hopeShiftArr %}
                {% set outer_loop = loop %}
                <span class="tabelSpan">{{ hopeShift.User.name }}</span>
                <span class="tabelSpan">{{ PART_FULL_JA_LIST[hopeShift.User.is_full_time] }}</span>
                <span class="tabelSpan">{{ hopeShift.User.level }}</span>
                {% for iDay in range(31) %}
                    {% if iDay < SUM_DAYS_OF_TARGET_MONTH %}
                        <span class="tabelSpan">{{ startEndListArr[outer_loop.index0][iDay] }}</span>
                    {% else %}
                        <span for="empty" class="tabelSpan"></span>
                    {% endif %}
                {% endfor %}
                <a class="tabelSpan" href="/{{ hopeShift.User.id }}/user/create/{{ PART_FULL_ENG_LIST[hopeShift.User.is_full_time] }}/hopeShift" role="button">編集</a>
                <a class="tabelSpan" href="/admin/delete/user/{{ hopeShift.User.id }}" role="button">削除</a>
            {% endfor %}
        </section>
        <br>
        <p><a href="/admin/edit/partLevel" role="button">実行</a><br>
        自動でシフトを作成します</p>
    {% else %}
        <p>まだ希望シフトの提出がありません</p>
    {% endif %}
    <hr>
    <h4>シフトの調整</h4>
    {% if userArr %}
        <section class="userTable">
            <span class="tabelSpan headLabel">氏名</span>
            <span class="tabelSpan headLabel">区分</span>
            <span class="tabelSpan headLabel">レベル</span>
            <span for="empty" class="tabelSpan headLabel"></span>
            {% for user in userArr %}
                <span class="tabelSpan">{{ user.name }}</span>
                <span class="tabelSpan">{{ PART_FULL_JA_LIST[user.is_full_time] }}</span>
                <span class="tabelSpan">{{ user.level }}</span>
                <a class="tabelSpan" href="/admin/delete/userRecord/{{ user.id }}" role="button">削除</a>
            {% endfor %}
        </section>
        <br>
        <p><a href="/admin/edit/partLevel" role="button">公開</a><br><br>
        完成版として全体に公開します</p>
        <p>1つだけ一時保存することが出来ます<br>
        <a href="/admin/edit/partLevel" role="button">保存する</a></p>
        <p>一時保存中のシフトをここに開く<br>
        <a href="/admin/edit/partLevel" role="button">開く</a></p>
        <p>希望シフトをここに開く<br>
        <a href="/admin/edit/partLevel" role="button">開く</a></p>
    {% else %}
        <p>シフトの自動作成後に使用できます</p>
    {% endif %}
    <hr>
    <h4>一時保存中のシフト</h4>
    {% if userArr %}
        <section class="userTable">
            <span class="tabelSpan headLabel">氏名</span>
            <span class="tabelSpan headLabel">区分</span>
            <span class="tabelSpan headLabel">レベル</span>
            <span for="empty" class="tabelSpan headLabel"></span>
            {% for user in userArr %}
                <span class="tabelSpan">{{ user.name }}</span>
                <span class="tabelSpan">{{ PART_FULL_JA_LIST[user.is_full_time] }}</span>
                <span class="tabelSpan">{{ user.level }}</span>
                <a class="tabelSpan" href="/admin/delete/userRecord/{{ user.id }}" role="button">削除</a>
            {% endfor %}
        </section>
    {% else %}
        <p>保存しているシフトはありません</p>
    {% endif %}
    <hr>
    <h4>公開中のシフト</h4>
    {% if releasedShiftArr %}
        <!-- <section class="submitTable">
            <span class="tabelSpan headLabel">氏名</span>
            <span class="tabelSpan headLabel">作成日時</span>
            <span class="tabelSpan headLabel">最終編集者</span>
            <span for="empty" class="tabelSpan headLabel"></span>
            {% for releasedShift in releasedShiftArr %}
                <span class="tabelSpan">{{ submit.name }}</span>
                <span class="tabelSpan">{{ submit.created_at }}</span>
                <span class="tabelSpan">{{ LAST_EDIT_LIST[submit.is_user_submission] }}</span>
                <a class="tabelSpan" href="/{{ submit.user_id }}/user/create/{{ PART_FULL_ENG_LIST[submit.is_full_time] }}/hopeShift" role="button">編集</a>
            {% endfor %}
        </section> -->
        <br>
        <a href="/admin/delete/releasedShift" role="button">公開を取り消す</a>
    {% else %}
        <p>公開中のシフトはありません</p>
    {% endif %}
    <hr>
    <a href="/admin/home" role="button">管理者HOMEに戻る</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="{{ url_for('static', filename='js/createShift.js') }}"></script>
{% endblock %}
